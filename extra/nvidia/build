#!/bin/sh -e

# KISS extracts tarball to open-gpu-kernel-modules
cd open-gpu-kernel-modules

# Build and install kernel modules
make KERNEL_SOURCE=/usr/src/linux modules -j$(nproc)
sudo make KERNEL_SOURCE=/usr/src/linu modules_install

# Update module dependencies
sudo depmod

# Configure GeForce support for RTX 4070 Ti
sudo mkdir -p /etc/modprobe.d
echo "options nvidia NVreg_OpenRmEnableUnsupportedGpus=1" | sudo tee /etc/modprobe.d/nvidia.conf

# Install user-space components
cd ..
chmod +x NVIDIA-Linux-x86_64*.run
sudo ./NVIDIA-Linux-x86_64-*.run --no-kernel-modules --silent

