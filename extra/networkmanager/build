#!/bin/sh -e

CXXFLAGS+="-O2 -fPIC"             \
meson setup build                 \
      --prefix=/usr               \
      --buildtype=release         \
      -D iwd=true                 \
      -D b_lto=true               \
      -D config_dns_rc_manager_default=symlink \
      -D libaudit=no              \
      -D ppp=false                \
      -D nmtui=true               \
      -D selinux=false            \
      -D qt=false                 \
      -D session_tracking=systemd \
      -D modem_manager=true

meson compile -C build
DESTDIR=$1 meson install -C build

install  -Dm 644 NetworkManager.conf "$1/etc/NetworkManager/NetworkManager.conf"
install -Dm 644 no-dns-update.conf  "$1/etc/NetworkManager/conf.d/no-dns-update.conf"
install -Dm 644 polkit.conf "$1/etc/NetworkManager/conf.d/polkit.conf"
install -Dm 644 org.freedesktop.NetworkManager.rules "$1/usr/share/polkit-1/rules.d/org.freedesktop.NetworkManager.rules"
