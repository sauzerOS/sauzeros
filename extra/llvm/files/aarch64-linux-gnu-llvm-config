#!/bin/bash
# This wrapper redirects queries to the cross-compiled llvm-config settings
# but runs on the host.
SYSROOT="/usr/aarch64-linux-gnu"

# We tell the loader to look in the sysroot for the ARM64 shared libs
# we just installed (like libstdc++, libLLVM, etc.)
export LD_LIBRARY_PATH="$SYSROOT/lib:$SYSROOT/usr/lib:$LD_LIBRARY_PATH"

# Run the real ARM64 llvm-config (using qemu-aarch64 behind the scenes)
# and fix the paths in the output so Rust finds them in the sysroot
$SYSROOT/usr/bin/llvm-config "$@" | sed "s|/usr|$SYSROOT/usr|g"
